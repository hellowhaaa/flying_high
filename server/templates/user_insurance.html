{% extends "layout.html" %} {% block content %}
<style>
  .outer {
    position: relative;
    min-height: 60vh; /* Set to the height of the viewport */
    display: flex;
    justify-content: center; /* Center horizontally */
    align-items: center; /* Center vertically */
  }
  .insurance-info {
    position: absolute; /* Allows absolute positioning inside */
    background: rgba(
      255,
      255,
      255,
      0.879
    ); /* Semi-transparent white background */
    padding: 2rem;
    border-radius: 1rem; /* Rounded corners */
    box-shadow: 0 0 1rem rgba(0, 0, 0, 0.1); /* Soft shadow */
    width: 75%;
    min-height: 400px; /* Ensures that there's enough space for positioning */
    transform: translateY(10px);
  }
  .container {
    position: relative; /* Allows absolute positioning inside */
  }
  .insurance-title {
    position: relative;
    top: -220px;
    left: 0px;
    color: white;
  }
  .my-insurance {
    position: relative;
    top: -210px;
    left: 50px;
    color: white;
  }
</style>

<div class="container-fluid">
  <div class="row">
    <!-- Sidebar -->
    <div class="col-md-2 bg-light sidebar py-5">
      <ul class="nav flex-column">
        <li class="nav-item">
          <a class="nav-link" href="info.html">我的資料</a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" href="insurance.html">我的保險</a>
        </li>
      </ul>
    </div>

    <!-- 靜態資料呈現 -->
    <!-- Main Content -->
<div class="col-md-10">
  <div class="py-4 px-md-5">
    <h1 class="mb-4">我的保險</h1>
    <div class="user-info">
      <!-- Static display state from MongoDB fetched data -->
      <div class="static-info mb-3">
        <p class="mb-2">
          投保公司:
          <span id="insurance-company-display">{{ user_info_dict['insurance_company'] }}</span>
        </p>
        <p class="mb-2">
          投保方案:
          <span id="plan-display">{{ user_info_dict['plan'] }}</span>
        </p>
        <p class="mb-2">
          投保額度:
          <span id="insured-amount-display">{{ user_info_dict['insured_amount'] }}</span>
        </p>
        <p class="mb-2">
          投保天數:
          <span id="days-display">{{ user_info_dict['days'] }}</span>
        </p>
        <button class="btn btn-secondary mt-3" onclick="toggleEdit(true)">
          編輯
        </button>
      </div>

      <!-- Editable input state -->
      <div class="editable-info" style="display: none">
        <div class="mb-3">
          <label for="insurance-company-edit" class="form-label">投保公司:</label>
          <input
            type="text"
            class="form-control"
            id="insurance-company-edit"
            name="insurance_company"
            value="{{ user_info_dict['insurance_company'] }}"
            autocomplete="off"
          />
        </div>
        <div class="mb-3">
          <label for="plan-edit" class="form-label">投保方案:</label>
          <input
            type="text"
            class="form-control"
            id="plan-edit"
            name="plan"
            value="{{ user_info_dict['plan'] }}"
            autocomplete="off"
          />
        </div>
        <div class="mb-3">
          <label for="insured-amount-edit" class="form-label">投保額度:</label>
          <input
            type="text"
            class="form-control"
            id="insured-amount-edit"
            name="insured_amount"
            value="{{ user_info_dict['insured_amount'] }}"
            autocomplete="off"
          />
        </div>
        <div class="mb-3">
          <label for="days-edit" class="form-label">投保天數:</label>
          <input
            type="number"
            class="form-control"
            id="days-edit"
            name="days"
            value="{{ user_info_dict['days'] }}"
            autocomplete="off"
          />
        </div>
        <button type="button" class="btn btn-success" onclick="submitChanges()">
          儲存
        </button>
        <button class="btn btn-secondary ms-2" onclick="toggleEdit(false)">
          取消
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  function toggleEdit(editMode) {
    const displayInfo = document.querySelector(".static-info");
    const editInfo = document.querySelector(".editable-info");

    if (editMode) {
      displayInfo.style.display = "none";
      editInfo.style.display = "block";
    } else {
      displayInfo.style.display = "block";
      editInfo.style.display = "none";
    }
  }

  function submitChanges() {
    const insuranceCompany = document.getElementById("insurance-company-edit").value;
    const plan = document.getElementById("plan-edit").value;
    const insuredAmount = document.getElementById("insured-amount-edit").value;
    const days = document.getElementById("days-edit").value;

    const data = {
      insurance_company: insuranceCompany,
      plan: plan,
      insured_amount: insuredAmount,
      days: days
    };

    fetch("/insurance/update_insurance", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(data => {
      console.log("Success:", data);
      document.getElementById("insurance-company-display").textContent = insuranceCompany;
      document.getElementById("plan-display").textContent = plan;
      document.getElementById("insured-amount-display").textContent = insuredAmount;
      document.getElementById("days-display").textContent = days;
      toggleEdit(false);
    })
    .catch(error => {
      console.error("Error:", error);
    });
  }
</script>

      {% block user_insurance_script %}
      <script src="../static/js/user_insurance.js"></script>
      {% endblock %} {% endblock %}
    </div>
  </div>
</div>
