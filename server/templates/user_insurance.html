{% extends "layout.html" %}{% block content %}
<style>
  .outer {
    position: relative;
    min-height: 60vh; /* Set to the height of the viewport */
    display: flex;
    justify-content: center; /* Center horizontally */
    align-items: center; /* Center vertically */
  }
  .insurance-info {
    position: absolute; /* Allows absolute positioning inside */
    background: rgba(
      255,
      255,
      255,
      0.879
    ); /* Semi-transparent white background */
    padding: 2rem;
    border-radius: 1rem; /* Rounded corners */
    box-shadow: 0 0 1rem rgba(0, 0, 0, 0.1); /* Soft shadow */
    width: 75%;
    min-height: 400px; /* Ensures that there's enough space for positioning */
    transform: translateY(10px);
  }
  .container {
    position: relative; /* Allows absolute positioning inside */
  }
  .insurance-title {
    position: relative;
    top: -220px;
    left: 0px;
    color: white;
  }
  .my-insurance {
    position: relative;
    top: -210px;
    left: 50px;
    color: white;
  }
</style>

<div class="container-fluid">
  <div class="row">
    <div class="col-md-2 bg-light sidebar py-5">
      <ul class="nav flex-column">
        <li class="nav-item">
          <a class="nav-link" href="info.html">我的資料</a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" href="insurance.html">我的保險</a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" href="notify.html">通知設定</a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" href="flight.html">我的航班</a>
        </li>
      </ul>
    </div>
    <div class="col-md-10">
      <div class="py-4 px-md-5">
        <h1 class="mb-4">我的保險</h1>
        <form
          id="insuranceForm"
          action="{{url_for('update_insurance')}}"
          method="POST"
        >
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
          <input
            type="hidden"
            name="insurance_company"
            id="selectedInsuranceCompany"
          />
          <input type="hidden" name="insurance_plan" id="selectedPlan" />
          <input
            type="hidden"
            name="insured_amount"
            id="selectedInsuranceAmount"
          />
          <input type="hidden" name="days" id="selectedDays" />

          <!-- 保險公司下拉選單 -->
          <div class="dropdown mb-3">
            <button
              class="btn btn-secondary dropdown-toggle"
              type="button"
              id="insuranceCompanyDropdown"
              data-bs-toggle="dropdown"
              aria-expanded="false"
            >
              選擇保險公司
            </button>
            <ul
              class="dropdown-menu"
              aria-labelledby="insuranceCompanyDropdown"
              id="insuranceCompanyMenu"
            >
              <li>
                <a class="dropdown-item" data-company="fubung">富邦人壽</a>
              </li>
              <li>
                <a class="dropdown-item" data-company="guotai">國泰人壽</a>
              </li>
            </ul>
          </div>
          <div class="dropdown mb-3">
            <button
              class="btn btn-secondary dropdown-toggle"
              type="button"
              id="planDropdown"
              data-bs-toggle="dropdown"
              aria-expanded="false"
            >
              選擇方案
            </button>
            <ul
              class="dropdown-menu"
              aria-labelledby="planDropdown"
              id="planMenu"
            ></ul>
          </div>
          <div class="dropdown mb-3">
            <button
              class="btn btn-secondary dropdown-toggle"
              type="button"
              id="insuranceAmountDropdown"
              data-bs-toggle="dropdown"
              aria-expanded="false"
            >
              選擇額度
            </button>
            <ul
              class="dropdown-menu"
              aria-labelledby="insuranceAmountDropdown"
              id="insuranceAmountMenu"
            ></ul>
          </div>
          <div class="dropdown mb-3">
            <button
              class="btn btn-secondary dropdown-toggle"
              type="button"
              id="daysDropdown"
              data-bs-toggle="dropdown"
              aria-expanded="false"
            >
              選擇天數
            </button>
            <ul
              class="dropdown-menu"
              aria-labelledby="daysDropdown"
              id="daysMenu"
            >
              <!-- Dynamically filled with JavaScript -->
            </ul>
          </div>
          <button type="submit" id="submitBtn" class="btn btn-primary">
            Submit
          </button>
        </form>
      </div>
    </div>
  </div>
</div>
{% block user_insurance_script %}
<!-- <script src="../static/js/user_insurance.js"> -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const insuranceCompanyMenu = document.getElementById(
      "insuranceCompanyDropdown"
    ).nextElementSibling;
    const planDropdownButton = document.getElementById("planDropdown");
    const planDropdownMenu = document.getElementById("planMenu");
    const insuranceAmountButton = document.getElementById(
      "insuranceAmountDropdown"
    );
    const insuranceAmountMenu = document.getElementById("insuranceAmountMenu");

    const planOptions = {
      fubung: ["S方案", "M方案", "L方案", "XL方案"],
      guotai: [
        "海外輕鬆型(T2)",
        "海外安心型(T2)",
        "賞櫻限定型(Z)",
        "早鳥豪華型(U2)",
      ],
    };

    insuranceCompanyMenu.addEventListener("click", function (event) {
      if (event.target.tagName === "A") {
        const selectedCompany = event.target.textContent;
        insuranceCompanyDropdown.textContent = selectedCompany; // Update dropdown button text
        updateDropdown(
          planDropdownMenu,
          planOptions[event.target.dataset.company]
        );
      }
    });

    function updateDropdown(dropdown, options) {
      dropdown.innerHTML = ""; // Clear previous options
      options.forEach((option) => {
        const li = document.createElement("li");
        const a = document.createElement("a");
        a.className = "dropdown-item";
        a.textContent = option;
        a.href = "#";
        a.addEventListener("click", function (e) {
          e.preventDefault();
          planDropdownButton.textContent = option; // Update dropdown button text
          if (insuranceAmountsByPlan[option]) {
            updateInsuranceAmountOptions(insuranceAmountsByPlan[option]);
          }
        });
        li.appendChild(a);
        dropdown.appendChild(li);
      });
    }

    const insuranceAmountsByPlan = {
      S方案: { min: 200, max: 1500, step: 100 },
      M方案: { min: 300, max: 1500, step: 100 },
      L方案: { min: 600, max: 1500, step: 100 },
      XL方案: { min: 1200, max: 1500, step: 100 },
      "海外輕鬆型(T2)": { min: 200, max: 1500, step: 100 },
      "海外安心型(T2)": { min: 200, max: 400, step: 100 },
      "賞櫻限定型(Z)": { min: 500, max: 1500, step: 100 },
      "早鳥豪華型(U2)": { min: 300, max: 1500, step: 100 },
    };

    function updateInsuranceAmountOptions({ min, max, step }) {
      insuranceAmountMenu.innerHTML = ""; // Clear previous options
      for (let amount = min; amount <= max; amount += step) {
        const li = document.createElement("li");
        const a = document.createElement("a");
        a.className = "dropdown-item";
        a.textContent = `${amount}萬`;
        a.href = "#";
        a.addEventListener("click", function (e) {
          e.preventDefault();
          insuranceAmountButton.textContent = `${amount}萬`; // Update dropdown button text
          document.getElementById("selectedInsuranceAmount").value = amount;
        });
        li.appendChild(a);
        insuranceAmountMenu.appendChild(li);
      }
    }
  });
  document.addEventListener("DOMContentLoaded", function () {
    const daysDropdownButton = document.getElementById("daysDropdown");
    const daysMenu = document.getElementById("daysMenu");

    for (let day = 3; day <= 30; day++) {
      const li = document.createElement("li");
      const a = document.createElement("a");
      a.className = "dropdown-item";
      a.textContent = `${day}天`;
      a.href = "#";
      a.addEventListener("click", function (e) {
        e.preventDefault();
        daysDropdownButton.textContent = `${day}天`; // Update dropdown button text
        document.getElementById("days-edit").value = day; // Update the hidden input to reflect selected day
      });
      li.appendChild(a);
      daysMenu.appendChild(li);
    }
  });

  document.addEventListener("DOMContentLoaded", function () {
    const insuranceCompanyMenu = document.getElementById(
      "insuranceCompanyMenu"
    );
    const planDropdownMenu = document.getElementById("planMenu");
    const insuranceAmountMenu = document.getElementById("insuranceAmountMenu");
    const daysMenu = document.getElementById("daysMenu");

    // 更新保險公司選擇
    insuranceCompanyMenu.addEventListener("click", function (event) {
      if (event.target.tagName === "A") {
        document.getElementById("selectedInsuranceCompany").value =
          event.target.dataset.company;
        document.getElementById("insuranceCompanyDropdown").textContent =
          event.target.textContent;
      }
    });

    // 更新方案選擇
    planDropdownMenu.addEventListener("click", function (event) {
      if (event.target.tagName === "A") {
        document.getElementById("selectedPlan").value =
          event.target.textContent;
        document.getElementById("planDropdown").textContent =
          event.target.textContent;
      }
    });

    // 更新保險額度選擇
    insuranceAmountMenu.addEventListener("click", function (event) {
      if (event.target.tagName === "A") {
        document.getElementById("selectedInsuranceAmount").value =
          event.target.textContent;
        document.getElementById("insuranceAmountDropdown").textContent =
          event.target.textContent;
      }
    });

    // 更新天數選擇
    daysMenu.addEventListener("click", function (event) {
      if (event.target.tagName === "A") {
        document.getElementById("selectedDays").value =
          event.target.textContent;
        document.getElementById("daysDropdown").textContent =
          event.target.textContent;
      }
    });
  });
</script>
{% endblock %} {% endblock %}
