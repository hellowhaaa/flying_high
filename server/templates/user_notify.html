{% extends "layout.html" %} {% block content %}

<div class="container-fluid">
  <div class="row">
    <!-- Sidebar -->
    <div class="col-md-2 bg-light sidebar py-5">
      <ul class="nav flex-column">
        <li class="nav-item">
          <a class="nav-link" href="info.html">我的資料</a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" href="insurance.html">我的保險</a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" href="notify.html">通知設定</a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" href="flight.html">我的航班</a>
        </li>
      </ul>
    </div>
    <!-- Content -->
    <div class="col-md-10">
      <h3>通知設定</h3>
      <form id="flightForm">
        <div class="row mb-3">
          <div class="col-md-6">
            <input
              class="form-check-input"
              type="checkbox"
              value="1"
              id="flight_change"
              name="flight_change"
            />
            <label class="form-check-label" for="flight_change">
              當起飛, 抵達航班改變是否收到email 通知
            </label>
          </div>
        </div>
        <div class="row mb-3">
          <div class="col-md-6">
            <input
              class="form-check-input"
              type="checkbox"
              value="1"
              id="flight_delay"
              name="flight_delay"
            />
            <label class="form-check-label" for="flight_delay">
              當回國航班delay是否email 通知提醒訂車票, 飯店
            </label>
          </div>
        </div>

        <div class="dropdown mb-3">
          <button
            class="btn btn-secondary dropdown-toggle"
            type="button"
            id="hsrDropdown"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            選擇最近的高鐵站
          </button>
          <ul class="dropdown-menu" aria-labelledby="hsrDropdown" id="hsrMenu">
            <li>
              <a class="dropdown-item" onclick="selectStation('南港')">南港</a>
            </li>
            <li>
              <a class="dropdown-item" onclick="selectStation('台北')">台北</a>
            </li>
            <li>
              <a class="dropdown-item" onclick="selectStation('板橋')">板橋</a>
            </li>
            <li>
              <a class="dropdown-item" onclick="selectStation('新竹')">新竹</a>
            </li>
            <li>
              <a class="dropdown-item" onclick="selectStation('苗栗')">苗栗</a>
            </li>
            <li>
              <a class="dropdown-item" onclick="selectStation('台中')">台中</a>
            </li>
            <li>
              <a class="dropdown-item" onclick="selectStation('彰化')">彰化</a>
            </li>
            <li>
              <a class="dropdown-item" onclick="selectStation('雲林')">雲林</a>
            </li>
            <li>
              <a class="dropdown-item" onclick="selectStation('嘉義')">嘉義</a>
            </li>
            <li>
              <a class="dropdown-item" onclick="selectStation('台南')">台南</a>
            </li>
            <li>
              <a class="dropdown-item" onclick="selectStation('左營')">左營</a>
            </li>
          </ul>
          <input type="hidden" name="hsr_station" id="hsr_station" />
        </div>

        <button
          type="button"
          class="btn btn-success"
          onclick="submitFlightInfo()"
        >
          Save Changes
        </button>
      </form>
    </div>

    <script>
      function selectStation(station) {
        document.getElementById("hsrDropdown").textContent = station; // Change button text to the selected station
        document.getElementById("hsr_station").value = station; // Update hidden input value to ensure it's included in the form submission
      }

      function submitFlightInfo() {
        const formData = new FormData(document.getElementById("flightForm"));

        fetch("/user/update_notify", {
          method: "POST",
          body: formData,
          headers: {
            Accept: "application/json",
            "X-CSRFToken": document
              .querySelector('meta[name="csrf-token"]')
              .getAttribute("content"), // Ensure CSRF token is included for security
          },
        })
          .then((response) => response.json())
          .then((data) => {
            console.log("Success:", data);
            alert("Flight information saved successfully!");
          })
          .catch((error) => {
            console.error("Error:", error);
            alert("Failed to save flight information.");
          });
      }
    </script>
    {% endblock %}
  </div>
</div>
