{% extends "layout.html" %}{% block homepage %}
<script
  src="https://code.jquery.com/jquery-2.1.1.min.js"
  type="text/javascript"
></script>
<link
  href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.1/css/select2.min.css"
  rel="stylesheet"
/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.1/js/select2.min.js"></script>
<script type="text/javascript">
  $(document).ready(function () {
    fetch("/fetch_user_depart_flight_code")
      .then((response) => response.json())
      .then((data) => {
        $("#depart_airlines").select2({
          data: Object.keys(data).map((key) => ({ id: key, text: key })),
        });

        $("#depart_airlines").on("change", function () {
          var selectedAirline = $(this).val();
          var flightCodes = data[selectedAirline] || [];
          $("#depart_flightCodes")
            .empty()
            .select2({
              data: flightCodes.map((code) => ({ id: code, text: code })),
            });
        });
      })
      .catch((error) =>
        console.error("Error fetching the airline data:", error)
      );
  });
</script>
<script type="text/javascript">
  $(document).ready(function () {
    fetch("/fetch_user_arrive_flight_code")
      .then((response) => response.json())
      .then((data) => {
        $("#arrive_airlines").select2({
          data: Object.keys(data).map((key) => ({ id: key, text: key })),
        });

        $("#arrive_airlines").on("change", function () {
          var selectedAirline = $(this).val();
          var flightCodes = data[selectedAirline] || [];
          $("#arrive_flightCodes")
            .empty()
            .select2({
              data: flightCodes.map((code) => ({ id: code, text: code })),
            });
        });
      })
      .catch((error) =>
        console.error("Error fetching the airline data:", error)
      );
  });
</script>
{% endblock %} {% block content %}

<div class="container-fluid">
  <div class="row">
    <!-- Sidebar -->
    <div class="col-md-2 bg-light sidebar py-5">
      <ul class="nav flex-column">
        <li class="nav-item">
          <a class="nav-link" href="info.html">我的資料</a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" href="insurance.html">我的保險</a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" href="notify.html">通知設定</a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" href="flight.html">我的航班</a>
        </li>
      </ul>
    </div>
    <!-- Content -->
    <div class="col-md-10">
      <h3>我的航班</h3>
      <form id="flightForm">
        <div class="row mb-3">
          <div class="col-md-6">
            <label for="startDate" class="form-label">旅遊開始日期:</label>
            <input
              type="date"
              class="form-control"
              id="startDate"
              name="startDate"
            />
          </div>
          <div class="col-md-6">
            <label for="endDate" class="form-label">旅遊結束日期:</label>
            <input
              type="date"
              class="form-control"
              id="endDate"
              name="endDate"
            />
          </div>
        </div>
        <!-- <div class="row mb-3">
          <div class="col-md-6">
            <label for="depart_flight" class="form-label">Depart Flight:</label>
            <select
              id="depart_flight"
              name="departFlight"
              class="form-control"
              style="width: 300px"
            >
            



            </select>
          </div>
          <div class="col-md-6">
            <input
              type="text"
              class="form-control"
              id="departFlightNumber"
              name="departFlightNumber"
              placeholder="Flight Number"
              oninput="validateInput(this);"
            />
          </div>
        </div> -->
        <p>到達班機</p>
        <div class="input-group mb-3">
          <select
            class="form-select"
            id="arrive_airlines"
            name="arriveFlight"
          ></select>
        </div>

        <div class="form-group mb-3">
          <select
            id="arrive_flightCodes"
            style="width: 300px"
            name="arriveFlightNumber"
          >
            <!-- Dropdown List Option -->
          </select>
        </div>

        <!-- 
        <div class="row mb-3">
          <div class="col-md-6">
            <label for="arrive_flight" class="form-label">Arrive Flight:</label>
            <select
              id="arrive_flight"
              name="arriveFlight"
              class="form-control"
              style="width: 300px"
            >
          
            </select>
          </div>
          <div class="col-md-6">
            <input
              type="text"
              class="form-control"
              id="arriveFlightNumber"
              name="arriveFlightNumber"
              placeholder="Flight Number"
              oninput="validateInput(this);"
            />
          </div>
        </div> -->
        <p>起飛班機</p>
        <div class="input-group mb-3">
          <select
            class="form-select"
            id="depart_airlines"
            name="departFlight"
          ></select>
        </div>

        <div class="form-group mb-3">
          <label for="depart_flightCodes" class="form-label"
            >Flight Number</label
          >
          <select
            class="form-control"
            id="depart_flightCodes"
            style="width: 100%"
            name="departFlightNumber"
          ></select>
        </div>

        <button
          type="button"
          class="btn btn-success"
          onclick="submitFlightInfo()"
        >
          Save Changes
        </button>
      </form>
    </div>

    <script>
      function validateInput(input) {
        let value = input.value.replace(/\D/g, "");
        if (value.startsWith("0") && value.length > 1) {
          value = value.substr(1);
        }
        input.value = value;
      }

      function submitFlightInfo() {
        const formData = new FormData(document.getElementById("flightForm"));

        fetch("/user/update_flight_info", {
          method: "POST",
          body: formData,
          headers: {
            Accept: "application/json",
            "X-CSRFToken": document
              .querySelector('meta[name="csrf-token"]')
              .getAttribute("content"), // Add CSRF token here from the meta tag
          },
        })
          .then((response) => response.json())
          .then((data) => {
            console.log("Success:", data);
            alert("Flight information saved successfully!");
          })
          .catch((error) => {
            console.error("Error:", error);
            alert("Failed to save flight information.");
          });
      }
    </script>

    {% endblock %}
  </div>
</div>
